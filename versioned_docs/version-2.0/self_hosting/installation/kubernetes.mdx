---
sidebar_label: Kubernetes
sidebar_position: 1
table_of_contents: true
---

# Self-hosting LangSmith on Kubernetes

:::important Enterprise License Required
Self-hosting LangSmith is an add-on to the Enterprise Plan designed for our largest, most security-conscious customers. See our [pricing page](https://www.langchain.com/pricing) for more detail, and contact us at sales@langchain.dev if you want to get a license key to trial LangSmith in your environment.
:::

This guide will walk you through the process of deploying LangSmith to a Kubernetes cluster. We will use Helm to install LangSmith and its dependencies.

We've successfully tested LangSmith on the following Kubernetes distributions:

- Google Kubernetes Engine (GKE)
- Amazon Elastic Kubernetes Service (EKS)
- Azure Kubernetes Service (AKS)
- OpenShift
- Minikube and Kind (for development purposes)

To review all configuration options, look at the values.yaml for the [LangSmith Helm Chart](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/README.md).

## Prerequisites

Ensure you have the following tools/items ready. Some items are marked optional:

1. A working Kubernetes cluster that you can access via `kubectl`. Your cluster should have the following minimum requirements:

   1. Recommended: At least 4 vCPUs, 16GB Memory available
      - You may need to tune resource requests/limits for all of our different services based off of organization size/usage
   2. Valid Dynamic PV provisioner or PVs available on your cluster. You can verify this by running:

   ```bash
   kubectl get storageclass
   ```

   The output should show at least one storage class with a provisioner that supports dynamic provisioning. For example:

   ```bash
     NAME            PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
     gp2 (default)   kubernetes.io/aws-ebs   Delete          WaitForFirstConsumer   false                  161d
   ```

2. Helm
   1. `brew install helm`
3. LangSmith License Key
   1. You can get this from your Langchain representative. Contact us at sales@langchain.dev for more information.
4. SSL(optional)
   1. This should be attachable to a load balancer that will be provisioned by your cloud provider. This will be used for the frontend service.
5. Api Key Salt
   1. This is a secret key that you can generate. It should be a random string of characters.
   2. You can generate this using the following command:
   ```bash
   openssl rand -base64 32
   ```
6. OpenAI API Key(optional).
   1. Used for natural language search feature(beta). Can specify OpenAI key in browser as well for the playground feature.
7. OAuth Configuration(optional).
   1. You can configure oauth using the `values.yaml` file. You will need to provide a `client_id` and `client_issuer_url` for your OAuth provider.
   2. Note, we do rely on the OIDC Authorization Code with PKCE flow. We currently support almost anything that is OIDC compliant however Google does not support this flow.
   3. Without OAuth, you will not be able to create users or organizations.
8. External Postgres(optional).
   1. In production settings we recommend using an external Postgres instance. You can configure external Postgres using the `values.yaml` file. You will need to provide a connection url for your Postgres instance.
9. External Redis(optional).
   1. You can configure external redis using the `values.yaml` file. You will need to provide a connection url for your redis instance.
   2. If using TLS, ensure that you use `rediss://` instead of `redis://. E.g "rediss://langsmith-redis:6380/0?password=foo"
   3. We only official support Redis versions >= 6. We also do not support sharded/clustered Redis(though you can point to a single node in a cluster).
10. External ClickHouse(optional).
    1. You can configure external clickhouse using the `values.yaml` file. You will need to provide several connection parameters for your ClickHouse instance.
    2. If using TLS, make sure to set `clickhouse.external.tls` to `true`.
    3. We only officially support ClickHouse versions >= 23. We also only support standalone ClickHouse or ClickHouse Cloud(not clustered or replicated).

## Configure your Helm Charts:

1. Create a new file called `langsmith_config.yaml`. This should have a similar structure to the `values.yaml` file in the LangSmith Helm Chart repository. Only include the values you want to override to avoid having to update the file every time the chart is updated.
2. Override any values in the file. Refer to the documentation for the [<u>LangSmith Helm Chart</u>](https://github.com/langchain-ai/helm/tree/main/charts/langsmith) to see all configurable values. Some values we recommend setting:
   1. Resources
   2. SSL(If on EKS or some other cloud provider)
      1. Add an annotation to the `frontend.service` object to tell your cloud provider to provision a load balancer with said certificate attached
   3. OpenAI Api Key
   4. Images
   5. Oauth

An example bare minimum config file `langsmith_config.yaml`:

```yaml
config:
  langsmithLicenseKey: ""
```

You can also see some example configurations in the examples directory of the Helm Chart repository here: [LangSmith Helm Chart Examples](https://github.com/langchain-ai/helm/tree/main/charts/langsmith/examples).

## Deploying to Kubernetes:

1.  Verify that you can connect to your Kubernetes cluster(note: We highly suggest installing into an empty namespace)

    1. Run `kubectl get pods`

       Output should look something like:

       ```bash
       kubectl get pods                                                                                                                                                                     âŽˆ langsmith-eks-2vauP7wf 21:07:46
       No resources found in default namespace.
       ```

2.  Ensure you have the Langchain Helm repo added. (skip this step if you are using local charts)

        helm repo add langchain https://langchain-ai.github.io/helm/
        "langchain" has been added to your repositories

3.  Run `helm install langsmith langchain/langsmith --values langsmith_config.yaml --namespace <your-namespace> --version <version>`

    Output should look something like:

    ```bash
    NAME: langsmith
    LAST DEPLOYED: Fri Sep 17 21:08:47 2021
    NAMESPACE: langsmith
    STATUS: deployed
    REVISION: 1
    TEST SUITE: None
    ```

4.  Run `kubectl get pods`
    Output should now look something like:

    ```bash
    langsmith-backend-6ff46c99c4-wz22d       1/1     Running   0          3h2m
    langsmith-frontend-6bbb94c5df-8xrlr      1/1     Running   0          3h2m
    langsmith-hub-backend-5cc68c888c-vppjj   1/1     Running   0          3h2m
    langsmith-playground-6d95fd8dc6-x2d9b    1/1     Running   0          3h2m
    langsmith-postgres-0                     1/1     Running   0          9h
    langsmith-queue-5898b9d566-tv6q8         1/1     Running   0          3h2m
    langsmith-redis-0                        1/1     Running   0          9h
    ```

## Validate your deployment:

1. Run `kubectl get services`

   Output should look something like:

   ```bash
   NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)        AGE
   langsmith-backend       ClusterIP      172.20.140.77    <none>                                                                    1984/TCP       35h
   langsmith-frontend      LoadBalancer   172.20.253.251   <external ip>                                                             80:31591/TCP   35h
   langsmith-hub-backend   ClusterIP      172.20.112.234   <none>                                                                    1985/TCP       35h
   langsmith-playground    ClusterIP      172.20.153.194   <none>                                                                    3001/TCP       9h
   langsmith-postgres      ClusterIP      172.20.244.82    <none>                                                                    5432/TCP       35h
   langsmith-redis         ClusterIP      172.20.81.217    <none>                                                                    6379/TCP       35h
   ```

2. Curl the external ip of the `langsmith-frontend` service:

   ```bash
   curl <external ip>/api/tenants
   [{"id":"00000000-0000-0000-0000-000000000000","has_waitlist_access":true,"created_at":"2023-09-13T18:25:10.488407","display_name":"Personal","config":{"is_personal":true,"max_identities":1},"tenant_handle":"default"}]%
   ```

3. Visit the external ip for the `langsmith-frontend` service on your browser

   The LangSmith UI should be visible/operational

   ![./static/langsmith_ui.png](../static/langsmith_ui.png)

## Using LangSmith

Now that LangSmith is running, you can start using it to trace your code. You can find more information on how to use self-hosted LangSmith in the [Self-Hosted Usage Guide](/self_hosting/usage).
